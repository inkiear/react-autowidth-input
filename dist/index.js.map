{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import React, {\n    DetailedHTMLProps,\n    InputHTMLAttributes,\n    CSSProperties,\n    useState,\n    useEffect,\n    useRef,\n    useLayoutEffect,\n    forwardRef,\n} from \"react\";\nimport PropTypes from \"prop-types\";\n\nfunction mergeRefs<T = any>(\n    refs: Array<React.MutableRefObject<T> | React.LegacyRef<T>>\n): React.RefCallback<T> {\n    return (value) => {\n        refs.forEach((ref) => {\n            if (typeof ref === \"function\") {\n                ref(value);\n            } else if (ref != null) {\n                (ref as React.MutableRefObject<T | null>).current = value;\n            }\n        });\n    };\n}\n\ninterface AutowidthInputProps\n    extends DetailedHTMLProps<\n        InputHTMLAttributes<HTMLInputElement>,\n        HTMLInputElement\n    > {\n    extraWidth?: number | string;\n    minWidth?: number | string;\n    wrapperClassName?: string;\n    wrapperStyle?: CSSProperties;\n    onAutosize?: (newWidth: number) => void;\n    placeholderIsMinWidth?: boolean;\n    value?: string;\n}\n\nconst sizerStyle: CSSProperties = {\n    position: \"absolute\",\n    top: 0,\n    left: 0,\n    visibility: \"hidden\",\n    height: 0,\n    overflow: \"scroll\",\n    whiteSpace: \"pre\",\n};\n\n/**\n * Automatically sized input field.\n */\nconst AutowidthInput: React.FC<AutowidthInputProps> = forwardRef<\n    HTMLInputElement,\n    AutowidthInputProps\n>(\n    (\n        {\n            extraWidth = 16,\n            wrapperClassName,\n            wrapperStyle: wrapperStyleProp,\n            onAutosize,\n            placeholderIsMinWidth,\n            ...props\n        },\n        forwardedRef\n    ) => {\n        const inputRef = useRef<HTMLInputElement>(null);\n        const sizerRef = useRef<HTMLDivElement>(null);\n        const placeholderSizerRef = useRef<HTMLDivElement>(null);\n\n        const [input, setInput] = useState<string>(\"\");\n        const [inputWidth, setInputWidth] = useState(0);\n\n        const usedValue = props.value ?? input;\n\n        const handleInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n            setInput(e.target.value);\n\n            if (props.onChange) props.onChange(e);\n        };\n\n        /* Copy styles of the input field to the sizer, ensuring that the width of the input adjusts accordingly */\n        useLayoutEffect(() => {\n            if (inputRef.current && sizerRef.current) {\n                const computedStyle = window.getComputedStyle(inputRef.current);\n\n                sizerRef.current.style.fontSize = computedStyle.fontSize;\n                sizerRef.current.style.fontFamily = computedStyle.fontFamily;\n                sizerRef.current.style.fontWeight = computedStyle.fontWeight;\n                sizerRef.current.style.fontStyle = computedStyle.fontStyle;\n                sizerRef.current.style.letterSpacing =\n                    computedStyle.letterSpacing;\n                sizerRef.current.style.textTransform =\n                    computedStyle.textTransform;\n            }\n        }, []);\n\n        useEffect(() => {\n            const sizerWidth = sizerRef.current?.scrollWidth;\n            const placeholderWidth = placeholderSizerRef.current?.scrollWidth;\n\n            if (sizerWidth && usedValue.length) {\n                /* If the input field has content, update the sizer to match its width  */\n\n                let width = sizerWidth;\n\n                if (\n                    placeholderIsMinWidth &&\n                    placeholderWidth &&\n                    sizerWidth < placeholderWidth &&\n                    placeholderSizerRef.current\n                ) {\n                    width = placeholderWidth;\n                }\n\n                if (width) {\n                    setInputWidth(width + +extraWidth);\n                    if (onAutosize) onAutosize(width);\n                }\n            } else if (props.placeholder && placeholderWidth) {\n                /* If no input value exists, check for placeholder value and update the sizer accordingly  */\n\n                setInputWidth(placeholderWidth + +extraWidth);\n\n                if (onAutosize) onAutosize(placeholderWidth);\n            } else if (sizerRef.current) {\n                /* If no input value or placeholder exists, update the sizer to the width of the \"extraWidth\" prop (default is 16) */\n\n                setInputWidth(+extraWidth);\n                if (onAutosize) onAutosize(+extraWidth);\n            }\n        }, [\n            usedValue,\n            props.placeholder,\n            extraWidth,\n            placeholderIsMinWidth,\n            onAutosize,\n            setInputWidth,\n        ]);\n\n        const wrapperStyle: CSSProperties = {\n            ...wrapperStyleProp,\n            position: \"relative\",\n            display: props.style?.display ?? \"inline-block\",\n        };\n\n        const inputStyle: CSSProperties = {\n            boxSizing: \"content-box\",\n            width: inputWidth,\n            ...props.style,\n        };\n\n        return (\n            <div\n                className={wrapperClassName}\n                style={wrapperStyle}\n                data-testid=\"wrapper\"\n            >\n                <div style={sizerStyle} ref={sizerRef} data-testid=\"sizer\">\n                    {usedValue}\n                </div>\n                <input\n                    {...props}\n                    ref={mergeRefs([inputRef, forwardedRef])}\n                    value={usedValue}\n                    style={inputStyle}\n                    onChange={handleInput}\n                    data-testid=\"input\"\n                />\n                {props.placeholder ? (\n                    <div\n                        ref={placeholderSizerRef}\n                        style={sizerStyle}\n                        data-testid=\"placeholder-sizer\"\n                    >\n                        {props.placeholder}\n                    </div>\n                ) : null}\n            </div>\n        );\n    }\n);\n\nAutowidthInput.propTypes = {\n    className: PropTypes.string, // className for the outer element\n    defaultValue: PropTypes.any, // default field value\n    extraWidth: PropTypes.oneOfType([\n        // additional width for input element\n        PropTypes.number,\n        PropTypes.string,\n    ]),\n    id: PropTypes.string, // id to use for the input, can be set for consistent snapshots\n    wrapperClassName: PropTypes.string, // className for the wrapper element callback for the input element\n    wrapperStyle: PropTypes.object, // css styles for the wrapper element\n    minWidth: PropTypes.oneOfType([\n        // minimum width for input element\n        PropTypes.number,\n        PropTypes.string,\n    ]),\n    onAutosize: PropTypes.func, // onAutosize handler: function(newWidth) {}\n    onChange: PropTypes.func, // onChange handler: function(event) {}\n    placeholder: PropTypes.string, // placeholder text\n    placeholderIsMinWidth: PropTypes.bool, // don't collapse size to less than the placeholder\n    style: PropTypes.object, // css styles for the outer element\n    value: PropTypes.string, // field value\n};\n\nexport default AutowidthInput;\n"],"names":["forwardRef","useRef","useState","useLayoutEffect","useEffect","React","PropTypes"],"mappings":"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"}